<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>å‘¨å°ç™½çš„ä¸ªäººåšå®¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="å‘¨å°ç™½çš„ä¸ªäººåšå®¢">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="å‘¨å°ç™½çš„ä¸ªäººåšå®¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="baixiaozhou">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="å‘¨å°ç™½çš„ä¸ªäººåšå®¢" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">å‘¨å°ç™½çš„ä¸ªäººåšå®¢</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS è®¢é˜…"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="æœç´¢"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="æœç´¢"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-çº¿ä¸Šé—®é¢˜æ’æŸ¥æ–¹æ³•æ±‡æ€»" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/14/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/" class="article-date">
  <time class="dt-published" datetime="2024-08-14T12:01:02.522Z" itemprop="datePublished">2024-08-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/14/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/">çº¿ä¸Šæ•…éšœæ’æŸ¥æ–¹æ³•å’Œå·¥å…·ä»‹ç»</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="çº¿ä¸Šå¸¸è§é—®é¢˜æ’æŸ¥"><a href="#çº¿ä¸Šå¸¸è§é—®é¢˜æ’æŸ¥" class="headerlink" title="çº¿ä¸Šå¸¸è§é—®é¢˜æ’æŸ¥"></a>çº¿ä¸Šå¸¸è§é—®é¢˜æ’æŸ¥</h1><p>åœ¨å¾ˆå¤šæ–‡ç« ä¸­ï¼Œæ¯å½“æåˆ°å»è§£å†³çº¿ä¸Šé—®é¢˜çš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†çš„å¤„ç†æ–¹å¼å°±æ˜¯ç™»å½•ç¯å¢ƒï¼Œå“å“å„ç§æ•²å‘½ä»¤ã€‚æ“ä½œæœ¬èº«æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¯¹äºå¾ˆå¤šäººè€Œè¨€ï¼Œæˆ‘è§‰å¾—è¿™ç§åšæ³•å…¶å®æ˜¯æœ¬æœ«å€’ç½®çš„ï¼Œè¿‡äºåœ¨ä¹å»å¿«é€ŸæŠ“ä½é‡ç‚¹é—®é¢˜ï¼Œè€Œå¿½ç•¥äº†ä»å…¨å±€å»çœ‹é—®é¢˜ã€‚é‚£ä¹ˆå¦‚æœæœ€å¼€å§‹ä¸å»æ“ä½œå„ç§å‘½ä»¤ï¼Œé‚£åº”è¯¥å¹²ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p><em><strong>çœ‹ç›‘æ§ï¼ï¼ï¼ï¼</strong></em></p>
<p>é¦–å…ˆä¸è¦è§‰å¾—è¿™ä¸ªæ˜¯åºŸè¯ï¼Œå¯¹äºå¾ˆå¤šåœºæ™¯æ¥è¯´ï¼Œä¸šåŠ¡è§„æ¨¡æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œæœ‰çš„æ—¶å€™å¹¶å‘è¶…è¿‡äº†æé™çš„æ€§èƒ½ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹éƒ½æ²¡æœ‰å¿…è¦å»åå°è¿›è¡Œå„ç§æŸ¥è¯¢ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡å¦‚è¯´æŸå¥—ä¸šåŠ¡ç³»ç»Ÿï¼Œæœ¬èº«åªèƒ½æ”¯æŒ 500 å¹¶å‘ï¼Œç°åœ¨å®é™…ä¸Šçš„é‡åˆ°äº† 2000ï¼Œå¯¼è‡´çº¿ä¸Šå„ç§å†…å­˜ã€CPUã€è´Ÿè½½çš„å‘Šè­¦ï¼Œè¿™ç§æƒ…å†µä¸‹è¿˜æœ‰å¿…è¦å»åå°æ•²<code>top</code>ã€<code>free</code>å—ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¦å®šçš„ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦è€ƒè™‘å¯¹ä¸šåŠ¡ç³»ç»Ÿè¿›è¡Œå¿«é€Ÿçš„æ‰©å®¹ç­‰ã€‚</p>
<p>çœ‹ç›‘æ§çš„æ„ä¹‰åœ¨äºå°½å¯èƒ½çš„æ‰¾åˆ°æ›´å¤šçš„æ€§èƒ½ç“¶é¢ˆæˆ–è€…å¼‚å¸¸çš„ç‚¹ï¼Œä»å…¨å±€å‡ºå‘ï¼Œå¯¹ç³»ç»Ÿå½“å‰å­˜åœ¨çš„é—®é¢˜å’Œå¼‚å¸¸ç‚¹æœ‰å…¨é¢çš„äº†è§£ã€‚</p>
<p>ç›‘æ§ç³»ç»Ÿå¤šç§å¤šæ ·ï¼Œä»è¾ƒæ—©çš„ zabbix åˆ°ç°åœ¨æ¯”è¾ƒæµè¡Œçš„prometheus+grafanaï¼ˆä¸¾ä¸¤ä¸ªå¸¸ç”¨çš„ä¾‹å­ï¼‰ï¼Œå¯¹äºç³»ç»Ÿä¸šåŠ¡éƒ½æœ‰æ¯”è¾ƒå®Œå–„çš„ç›‘æ§ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´åŠ å…·ä½“çš„äº†è§£åˆ°ç³»ç»Ÿè¿è¡Œå…¨è²Œã€‚å¦‚æœä½ å¯¹è¿™äº›éƒ½ä¸å–œæ¬¢ï¼Œé‚£ä¹ˆä½ è‡ªå·±å†™ä¸€ä¸ªç›‘æ§ç³»ç»Ÿä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p>
<p>å½“æˆ‘ä»¬çœ‹å®Œç›‘æ§ä¹‹åï¼ˆå‡è®¾ä½ çœŸçš„çœ‹äº†ï¼‰ï¼Œæ¥ä¸‹æ¥è¿›å…¥å®é™…æ“ä½œç¯èŠ‚ï¼Œæˆ‘ä¼šä»è¿™äº›æŒ‡æ ‡çš„è¯¦ç»†å«ä¹‰å‡ºå‘ï¼Œç„¶åå°½å¯èƒ½åœ°å°†å„ç§å¤„ç†æ–¹å¼åˆ†äº«ç»™å¤§å®¶ã€‚</p>
<h2 id="CPUä½¿ç”¨ç‡é£™å‡"><a href="#CPUä½¿ç”¨ç‡é£™å‡" class="headerlink" title="CPUä½¿ç”¨ç‡é£™å‡"></a>CPUä½¿ç”¨ç‡é£™å‡</h2><h3 id="å¦‚ä½•è®©CPUä½¿ç”¨ç‡é£™å‡"><a href="#å¦‚ä½•è®©CPUä½¿ç”¨ç‡é£™å‡" class="headerlink" title="å¦‚ä½•è®©CPUä½¿ç”¨ç‡é£™å‡"></a>å¦‚ä½•è®©CPUä½¿ç”¨ç‡é£™å‡</h3><p>è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆç®€å•ï¼Œåªè¦æœ‰è®¡ç®—ä»»åŠ¡ä¸€ç›´å­˜åœ¨ï¼Œè®© CPU ä¸€ç›´å¤„äºç¹å¿™ä¹‹ä¸­ï¼Œé‚£ä¹ˆ CPU å¿…ç„¶é£™å‡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—çš„å·¥å…·å»æ¨¡æ‹Ÿè¿™ä¸ªæƒ…å†µã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/baixiaozhou/SysStress">github SysStress</a> è¿™æ˜¯æˆ‘è‡ªå·±ç”¨ golang å†™çš„å‹æµ‹å·¥å…·(è¿˜åœ¨å¼€å‘ä¸­ï¼Œå¯ä»¥ç‚¹ä¸ª star è®©æˆ‘æ›´æœ‰åŠ¨åŠ›ğŸ˜‚)</p>
<p>ä½¿ç”¨æ–¹æ³•:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./sysstress cpu --cpu-number 10 --duration 10m</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå°±æ˜¯æ¨¡æ‹Ÿå ç”¨ 10 æ ¸å¿ƒçš„ CPU å¹¶æŒç»­ 10minï¼Œå½“ç„¶å¤§å®¶ä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„å‹æµ‹å·¥å…·ï¼Œæ¯”å¦‚<code>stress-ng</code></p>
<h3 id="å¦‚ä½•åˆ¤æ–­å’Œå‘ç°CPUä½¿ç”¨ç‡é£™å‡"><a href="#å¦‚ä½•åˆ¤æ–­å’Œå‘ç°CPUä½¿ç”¨ç‡é£™å‡" class="headerlink" title="å¦‚ä½•åˆ¤æ–­å’Œå‘ç°CPUä½¿ç”¨ç‡é£™å‡"></a>å¦‚ä½•åˆ¤æ–­å’Œå‘ç°CPUä½¿ç”¨ç‡é£™å‡</h3><p>é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ï¼Œè·Ÿ CPU ä½¿ç”¨ç‡ç›¸å…³çš„æœ‰å“ªäº›æŒ‡æ ‡ã€‚æˆ‘ä»¬é€šè¿‡ <code>top</code> å‘½ä»¤å°±å¯ä»¥çœ‹åˆ°å…·ä½“çš„ä¿¡æ¯</p>
<p><img src="/../images/top.png" alt="top"><br>è¿™äº›è¾“å‡ºä¸­æœ‰ä¸€è¡Œæ˜¯ <code>%Cpu(s)</code>, è¿™è¡Œå±•ç¤ºäº† CPU çš„æ•´ä½“ä½¿ç”¨æƒ…å†µï¼Œæ˜¯ä¸€ä¸ªç™¾åˆ†æ¯”çš„å½¢å¼ï¼Œæˆ‘ä»¬è¯¦ç»†é˜è¿°ä¸‹è¿™å‡ ä¸ªå­—æ®µçš„å«ä¹‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">us, user    : time running un-niced user processes   æœªé™ä½ä¼˜å…ˆçº§çš„ç”¨æˆ·è¿›ç¨‹æ‰€å ç”¨çš„æ—¶é—´</span><br><span class="line">sy, system  : time running kernel processes          å†…æ ¸è¿›ç¨‹æ‰€å ç”¨çš„æ—¶é—´</span><br><span class="line">ni, nice    : time running niced user processes      é™ä½ä¼˜å…ˆçº§çš„ç”¨æˆ·è¿›ç¨‹æ‰€å ç”¨çš„æ—¶é—´</span><br><span class="line">id, idle    : time spent in the kernel idle handler  ç©ºé—²çš„æ—¶é—´</span><br><span class="line">wa, IO-wait : time waiting for I/O completion        ç­‰å¾… I/O æ“ä½œå®Œæˆæ‰€èŠ±è´¹çš„æ—¶é—´</span><br><span class="line">hi : time spent servicing hardware interrupts        å¤„ç†ç¡¬ä»¶ä¸­æ–­æ‰€èŠ±è´¹çš„æ—¶é—´</span><br><span class="line">si : time spent servicing software interrupts        å¤„ç†è½¯ä»¶ä¸­æ–­æ‰€èŠ±è´¹çš„æ—¶é—´</span><br><span class="line">st : time stolen from this vm by the hypervisor      è¢«è™šæ‹Ÿæœºç®¡ç†ç¨‹åºä»æ­¤è™šæ‹Ÿæœºä¸­çªƒå–çš„æ—¶é—´</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™äº›æŒ‡æ ‡ä¸­ï¼Œä¸€èˆ¬å…³æ³¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯ usã€syã€idã€waï¼ˆå…¶ä»–å‡ ä¸ªæŒ‡æ ‡å¾ˆé«˜çš„æƒ…å†µæˆ‘ä¸ªäººç›®å‰åŸºæœ¬ä¸Šæ²¡æœ‰é‡åˆ°è¿‡ï¼‰</p>
<p>ä¸Šè¿°æŒ‡æ ‡åæ˜ äº†ç³»ç»Ÿæ•´ä½“çš„ CPU æƒ…å†µã€‚è€Œç¨‹åºåœ¨æ“ä½œç³»ç»Ÿä¸­å®é™…ä¸Šæ˜¯ä»¥ä¸€ä¸ªä¸ªçš„è¿›ç¨‹å­˜åœ¨çš„ï¼Œé‚£æˆ‘ä»¬å¦‚ä½•ç¡®å®šåˆ°å ç”¨ CPU é«˜çš„è¿›ç¨‹å‘¢ï¼Ÿè®©æˆ‘ä»¬çš„ç›®å…‰ä» top çš„å¤´éƒ¨ä¿¡æ¯å¾€ä¸‹ç§»åŠ¨ï¼Œä¸‹é¢å°±å±•ç¤ºäº†è¯¦ç»†çš„è¿›ç¨‹ä¿¡æ¯<br><img src="/../images/top-process.png" alt="top-process"></p>
<p>è¿™äº›ç¨‹åºé»˜è®¤æ˜¯æŒ‰ç…§ CPU çš„ä½¿ç”¨ç‡ä»é«˜åˆ°åº•è¿›è¡Œæ’åºçš„ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡åœ¨<code>top</code>çš„æ—¶å€™è¾“å…¥<code>P</code>è¿›è¡Œæ’åºï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ç³»ç»Ÿä¸­æ¶ˆè€— CPU èµ„æºçš„è¯¦ç»†è¿›ç¨‹ä¿¡æ¯</p>
<p>ä¸Šé¢æ˜¯æˆ‘é€šè¿‡ <code>./sysstress cpu --cpu-number 10 --duration 10m</code> å‹æµ‹ç¨‹åºè·‘å‡ºæ¥çš„ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ sysstress ç¨‹åºå ç”¨äº† 1002 çš„ %CPUï¼Œä¹Ÿå°±æ˜¯è¯´åŸºæœ¬ä¸Šæ˜¯ 10 ä¸ªæ ¸å¿ƒï¼Œé‚£æˆ‘ä»¬è·‘ä¸€ä¸ªæ›´é«˜çš„ï¼Œå°†<code>--cpu-number</code>åŠ åˆ° 60 çœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆ<br><img src="/../images/stress-cpu.png" alt="stress-cpu"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ¬¡%CPUæ‰“åˆ°äº† 6000ï¼Œé‚£å¾ˆå¤šäººå°±å¥½å¥‡æˆ‘æ—¥å¸¸çš„ç¨‹åºè·‘åˆ°å¤šé«˜ç®—é«˜å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼Œç°åœ¨çš„æœåŠ¡å™¨ç»å¤§éƒ¨åˆ†éƒ½æ˜¯å¤šæ ¸å¿ƒ CPUï¼ˆ1C2Gè¿™ç§è‡ªå·±ç”¨æ¥ç©çš„å¿½ç•¥ï¼‰ï¼ŒCPU çš„æ ¸å¿ƒæ•°å†³å®šäº†æˆ‘ä»¬ç¨‹åºåœ¨åŒä¸€æ—¶é—´èƒ½å¤Ÿæ‰§è¡Œå¤šå°‘ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªé«˜ä¸é«˜æ˜¯ç›¸å¯¹äºæœºå™¨é…ç½®è€Œè¨€çš„ã€‚å¦‚æœä½ çš„æœºå™¨åªæœ‰ 16Cï¼Œé‚£ä¹ˆå•ä¸ªè¿›ç¨‹å ç”¨çš„ %CPU åˆ° 1000ï¼Œé‚£ä¹ˆå…¶å®å·²ç»ç®—æ˜¯æ¯”è¾ƒé«˜äº†ã€‚å¦‚æœæ˜¯ 256C çš„CPUï¼ˆåœŸè±ªçº§é…ç½®ï¼‰ï¼Œé‚£ä¹ˆå•ä¸ªè¿›ç¨‹å ç”¨çš„ %CPU åˆ° 6000ï¼Œå¯¹äºç³»ç»Ÿçš„ç¨³å®šæ€§å½±å“å°±æ²¡æœ‰é‚£ä¹ˆå¤§äº†ã€‚</p>
<p>ä¸Šè¿°æˆ‘ä»¬è¯´çš„æƒ…å†µæ˜¯è¿›ç¨‹å ç”¨ CPU å¯¹æ•´ä¸ªç³»ç»Ÿçš„å½±å“ï¼Œé‚£ä¹ˆè¿›ç¨‹å ç”¨çš„ CPU å¯¹ç³»ç»Ÿçš„å½±å“ä¸å¤§å°±ä»£è¡¨è¿™ä¸ªç¨‹åºä¸€å®šæ²¡æœ‰é—®é¢˜å—ï¼Ÿç­”æ¡ˆæ˜¾ç„¶æ˜¯æœªå¿…çš„ã€‚</p>
<p>æˆ‘ä»¬è¿˜æ˜¯è¦å›å½’åˆ°ä¸šåŠ¡æœ¬èº«ï¼Œå¦‚æœè¿›ç¨‹çš„ CPU å ç”¨åœ¨ä¸šåŠ¡å˜åŠ¨ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œå‘ç”Ÿäº†å¼‚å¸¸æ³¢åŠ¨ï¼Œæˆ–è€…æ­£å¸¸æƒ…å†µä¸‹ä¸šåŠ¡ä¸ä¼šæ¶ˆè€—è¿™ä¹ˆé«˜çš„ CPUï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ç»§ç»­æ’æŸ¥äº†ã€‚</p>
<h3 id="å¦‚ä½•ç¡®å®šCPUé£™å‡çš„æ ¹æº"><a href="#å¦‚ä½•ç¡®å®šCPUé£™å‡çš„æ ¹æº" class="headerlink" title="å¦‚ä½•ç¡®å®šCPUé£™å‡çš„æ ¹æº"></a>å¦‚ä½•ç¡®å®šCPUé£™å‡çš„æ ¹æº</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/14/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/" data-id="clzv87lva0000c3onbyvc4ecf" data-title="çº¿ä¸Šæ•…éšœæ’æŸ¥æ–¹æ³•å’Œå·¥å…·ä»‹ç»" class="article-share-link"><span class="fa fa-share">åˆ†äº«</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-JAVAé—®é¢˜å®šä½" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/13/JAVA%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/" class="article-date">
  <time class="dt-published" datetime="2024-08-13T08:42:39.872Z" itemprop="datePublished">2024-08-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/13/JAVA%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/">JAVAé—®é¢˜å®šä½</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ä¸€ã€JAVA-ç›¸å…³å‘½ä»¤"><a href="#ä¸€ã€JAVA-ç›¸å…³å‘½ä»¤" class="headerlink" title="ä¸€ã€JAVA ç›¸å…³å‘½ä»¤"></a>ä¸€ã€JAVA ç›¸å…³å‘½ä»¤</h1><h2 id="1-jps"><a href="#1-jps" class="headerlink" title="1.jps"></a>1.jps</h2><p>jps - Lists the instrumented Java Virtual Machines (JVMs) on the target system. This command is experimental and unsupported.</p>
<p>ç›¸å…³å‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS</span><br><span class="line">       The jps command supports a number of options that modify the output of the command. These options are subject to change or removal in the future.</span><br><span class="line">       -q</span><br><span class="line">              Suppresses the output of the class name, JAR file name, and arguments passed to the main method, producing only a list of local JVM identifiers.</span><br><span class="line">       -m</span><br><span class="line">              Displays the arguments passed to the main method. The output may be null for embedded JVMs.</span><br><span class="line">       -l</span><br><span class="line">              Displays the full package name for the application&#x27;s main class or the full path name to the application&#x27;s JAR file.</span><br><span class="line">       -v</span><br><span class="line">              Displays the arguments passed to the JVM.</span><br><span class="line">       -V</span><br><span class="line">              Suppresses the output of the class name, JAR file name, and arguments passed to the main method, producing only a list of local JVM identifiers.</span><br><span class="line">       -Joption</span><br><span class="line">              Passes option to the JVM, where option is one of the options described on the reference page for the Java application launcher. For example, -J-Xms48m sets the</span><br><span class="line">              startup memory to 48 MB. See java(1).</span><br></pre></td></tr></table></figure>

<h2 id="2-jinfo"><a href="#2-jinfo" class="headerlink" title="2.jinfo"></a>2.jinfo</h2><p>jinfoï¼ˆJava Virtual Machine Configuration Informationï¼‰æ˜¯JDKæä¾›çš„ä¸€ä¸ªå¯ä»¥å®æ—¶æŸ¥çœ‹Javaè™šæ‹Ÿæœºå„ç§é…ç½®å‚æ•°å’Œç³»ç»Ÿå±æ€§çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ä½¿ç”¨jpså‘½ä»¤çš„-vå‚æ•°å¯ä»¥æŸ¥çœ‹Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶æ˜¾å¼æŒ‡å®šçš„é…ç½®å‚æ•°ï¼Œå¦‚æœæƒ³æŸ¥çœ‹æ²¡æœ‰æ˜¾å¼æŒ‡å®šçš„é…ç½®å‚æ•°å°±å¯ä»¥ä½¿ç”¨jinfoå‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ã€‚å¦å¤–ï¼Œjinfoå‘½ä»¤è¿˜å¯ä»¥æŸ¥è¯¢Javaè™šæ‹Ÿæœºè¿›ç¨‹çš„System.getProperties()çš„å†…å®¹ã€‚</p>
<p>ä»¥tomcatè¿›ç¨‹ä¸ºä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">Attaching to process ID 2045, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.242-b08</span><br><span class="line">Java System Properties:</span><br><span class="line"></span><br><span class="line">java.vendor = Huawei Technologies Co., Ltd</span><br><span class="line">sun.java.launcher = SUN_STANDARD</span><br><span class="line">catalina.base = /usr/share/tomcat</span><br><span class="line">sun.management.compiler = HotSpot 64-Bit Tiered Compilers</span><br><span class="line">sun.nio.ch.bugLevel = </span><br><span class="line">catalina.useNaming = true</span><br><span class="line">jnidispatch.path = /var/cache/tomcat/temp/jna--903012287/jna4240128671455089550.tmp</span><br><span class="line">os.name = Linux</span><br><span class="line">sun.boot.class.path = /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/resources.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/rt.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/jsse.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/jce.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/charsets.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/jfr.jar:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/classes</span><br><span class="line">java.vm.specification.vendor = Oracle Corporation</span><br><span class="line">java.runtime.version = 1.8.0_242-b08</span><br><span class="line">jna.loaded = true</span><br><span class="line">user.name = xxx</span><br><span class="line">tomcat.util.scan.StandardJarScanFilter.jarsToScan = taglibs-standard-impl*.jar</span><br><span class="line">shared.loader = </span><br><span class="line">tomcat.util.buf.StringCache.byte.enabled = true</span><br><span class="line">user.language = en</span><br><span class="line">java.naming.factory.initial = org.apache.naming.java.javaURLContextFactory</span><br><span class="line">sun.boot.library.path = /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/amd64</span><br><span class="line">java.version = 1.8.0_242</span><br><span class="line">java.util.logging.manager = org.apache.juli.ClassLoaderLogManager</span><br><span class="line">user.timezone = Asia/Shanghai</span><br><span class="line">sun.arch.data.model = 64</span><br><span class="line">java.util.concurrent.ForkJoinPool.common.threadFactory = org.apache.catalina.startup.SafeForkJoinWorkerThreadFactory</span><br><span class="line">java.endorsed.dirs = </span><br><span class="line">sun.cpu.isalist = </span><br><span class="line">sun.jnu.encoding = UTF-8</span><br><span class="line">file.encoding.pkg = sun.io</span><br><span class="line">package.access = sun.,org.apache.catalina.,org.apache.coyote.,org.apache.jasper.,org.apache.tomcat.</span><br><span class="line">file.separator = /</span><br><span class="line">java.specification.name = Java Platform API Specification</span><br><span class="line">java.class.version = 52.0</span><br><span class="line">user.country = US</span><br><span class="line">java.home = /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre</span><br><span class="line">java.vm.info = mixed mode</span><br><span class="line">os.version = 4.19.90-24.4.v2101.ky10.x86_64</span><br><span class="line">sun.font.fontmanager = sun.awt.X11FontManager</span><br><span class="line">path.separator = :</span><br><span class="line">java.vm.version = 25.242-b08</span><br><span class="line">jboss.i18n.generate-proxies = true</span><br><span class="line">java.awt.printerjob = sun.print.PSPrinterJob</span><br><span class="line">sun.io.unicode.encoding = UnicodeLittle</span><br><span class="line">awt.toolkit = sun.awt.X11.XToolkit</span><br><span class="line">package.definition = sun.,java.,org.apache.catalina.,org.apache.coyote.,org.apache.jasper.,org.apache.naming.,org.apache.tomcat.</span><br><span class="line">java.naming.factory.url.pkgs = org.apache.naming</span><br><span class="line">mail.mime.splitlongparameters = false</span><br><span class="line">java.security.egd = file:/dev/./urandom</span><br><span class="line">user.home = /home/shterm</span><br><span class="line">java.specification.vendor = Oracle Corporation</span><br><span class="line">tomcat.util.scan.StandardJarScanFilter.jarsToSkip = activ*.jar,amqp-client.jar,annotations-api.jar,ant-junit*.jar,ant-launcher.jar,ant.jar,antlr.jar,aopalliance.jar,asm-*.jar,aspectj*.jar,bcp*.jar,bootstrap.jar,catalina-ant.jar,catalina-ha.jar,catalina-jmx-remote.jar,catalina-storeconfig.jar,catalina-tribes.jar,catalina-ws.jar,catalina.jar,cglib-*.jar,classmate.jar,cobertura-*.jar,commons-*.jar,compress-lzf.jar,curator-*.jar,db2-jdbc.jar,dom4j-*.jar,easymock-*.jar,ecj-*.jar,el-api.jar,elasticsearch.jar,geronimo-spec-jaxrpc*.jar,groovy-all.jar,guava.jar,h2*.jar,hamcrest-*.jar,hibernate*.jar,hppc.jar,http*.jar,icu4j-*.jar,itext*.jar,jackson-*.jar,jandex.jar,jasper-el.jar,jasper.jar,jasperreports*.jar,jaspic-api.jar,javamail.jar,javassist.jar,jaxb-*.jar,jaxen*.jar,jboss*.jar,jc*.jar,jdom-*.jar,jedis.jar,jetty-*.jar,jfreechart.jar,jgit.jar,jline.jar,jmx-tools.jar,jmx.jar,jna.jar,joda-time.jar,jr-*.jar,jsch.jar,json*.jar,jsoup.jar,jsp-api.jar,jsr166e.jar,jstl.jar,jta*.jar,junit-*.jar,junit.jar,liquibase-*.jar,log4j*.jar,lucene*.jar,mail*.jar,mariadb-jdbc.jar,mssql-jdbc.jar,mybatis.jar,netty.jar,nmap4j.jar,objenesis*.jar,olap4j.jar,opc*.jar,oracle-jdbc.jar,oraclepki.jar,oro-*.jar,poi*.jar,postgresql-jdbc.jar,quartz.jar,servlet-api-*.jar,servlet-api.jar,slf4j*.jar,snakeyaml.jar,snmp4j.jar,spring*.jar,sshd-core.jar,taglibs-standard-spec-*.jar,tagsoup-*.jar,t-digest.jar,tomcat-api.jar,tomcat-coyote.jar,tomcat-dbcp.jar,tomcat-i18n-*.jar,tomcat-jdbc.jar,tomcat-jni.jar,tomcat-juli-adapters.jar,tomcat-juli.jar,tomcat-util-scan.jar,tomcat-util.jar,tomcat-websocket.jar,tools.jar,validation-api.jar,velocypack.jar,websocket-api.jar,wl*.jar,wsdl4j*.jar,xercesImpl.jar,xml-apis.jar,xmlbeans.jar,xmlParserAPIs-*.jar,xmlParserAPIs.jar,xom-*.jar,xz.jar,zip4j.jar,zookeeper.jar</span><br><span class="line">java.library.path = /usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">java.vendor.url = http://jdk.rnd.huawei.com/</span><br><span class="line">java.vm.vendor = Huawei Technologies Co., Ltd</span><br><span class="line">common.loader = &quot;$&#123;catalina.base&#125;/lib&quot;,&quot;$&#123;catalina.base&#125;/lib/*.jar&quot;,&quot;$&#123;catalina.home&#125;/lib&quot;,&quot;$&#123;catalina.home&#125;/lib/*.jar&quot;</span><br><span class="line">java.runtime.name = OpenJDK Runtime Environment</span><br><span class="line">sun.java.command = org.apache.catalina.startup.Bootstrap start</span><br><span class="line">java.class.path = /usr/share/tomcat/bin/bootstrap.jar:/usr/share/tomcat/bin/tomcat-juli.jar:/usr/lib/java/commons-daemon.jar</span><br><span class="line">java.vm.specification.name = Java Virtual Machine Specification</span><br><span class="line">java.vm.specification.version = 1.8</span><br><span class="line">catalina.home = /usr/share/tomcat</span><br><span class="line">sun.cpu.endian = little</span><br><span class="line">sun.os.patch.level = unknown</span><br><span class="line">java.awt.headless = true</span><br><span class="line">java.io.tmpdir = /var/cache/tomcat/temp</span><br><span class="line">java.vendor.url.bug = http://jdk.rnd.huawei.com/</span><br><span class="line">server.loader = </span><br><span class="line">java.rmi.server.hostname = 127.0.0.1</span><br><span class="line">jna.platform.library.path = /usr/lib64:/lib64:/usr/lib:/lib:/usr/lib64/tracker-miners-2.0:/usr/lib64/tracker-2.0:/usr/lib64/dyninst:/usr/libexec/sudo:/usr/lib64/sssd:/usr/pgsql-9.6/lib:/usr/lib64/perl5/CORE:/usr/lib64/opencryptoki:/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/amd64/jli:/usr/lib64/bind9-export</span><br><span class="line">os.arch = amd64</span><br><span class="line">java.awt.graphicsenv = sun.awt.X11GraphicsEnvironment</span><br><span class="line">java.ext.dirs = /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.242.b08-1.h5.ky10.x86_64/jre/lib/ext:/usr/java/packages/lib/ext</span><br><span class="line">user.dir = /usr/share/tomcat</span><br><span class="line">line.separator = </span><br><span class="line"></span><br><span class="line">java.vm.name = OpenJDK 64-Bit Server VM</span><br><span class="line">log4j.configurationFile = /etc/tomcat/log4j2.xml</span><br><span class="line">file.encoding = UTF-8</span><br><span class="line">com.sun.jndi.ldap.object.disableEndpointIdentification = </span><br><span class="line">java.specification.version = 1.8</span><br><span class="line"></span><br><span class="line">VM Flags:</span><br><span class="line">Non-default VM flags: -XX:CICompilerCount=4 -XX:GCLogFileSize=20971520 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=null -XX:InitialHeapSize=243269632 -XX:MaxHeapSize=1610612736 -XX:MaxNewSize=536870912 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=80740352 -XX:NumberOfGCLogFiles=15 -XX:OldSize=162529280 -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseGCLogFileRotation -XX:+UseParallelGC </span><br><span class="line">Command line:  -Xmx1536m -Djava.security.egd=file:/dev/./urandom -Djava.awt.headless=true -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/var/log/tomcat -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=15 -XX:GCLogFileSize=20m -XX:+PrintGCDateStamps -XX:+PrintGCDetails -Xloggc:/var/log/tomcat/tomcat-gc-%t.log -Dcom.sun.jndi.ldap.object.disableEndpointIdentification -Dcatalina.base=/usr/share/tomcat -Dcatalina.home=/usr/share/tomcat -Djava.endorsed.dirs= -Djava.io.tmpdir=/var/cache/tomcat/temp -Dlog4j.configurationFile=/etc/tomcat/log4j2.xml -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager</span><br></pre></td></tr></table></figure>

<h2 id="3-jstat"><a href="#3-jstat" class="headerlink" title="3.jstat"></a>3.jstat</h2><p>å‘½ä»¤å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>generalOptionsï¼šé€šç”¨é€‰é¡¹ï¼Œå¦‚æœæŒ‡å®šä¸€ä¸ªé€šç”¨é€‰é¡¹ï¼Œå°±ä¸èƒ½æŒ‡å®šä»»ä½•å…¶ä»–é€‰é¡¹æˆ–å‚æ•°ã€‚å®ƒåŒ…æ‹¬å¦‚ä¸‹ä¸¤ä¸ªé€‰é¡¹ï¼š</li>
<li>-helpï¼šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚</li>
<li>-optionsï¼šæ˜¾ç¤ºoutputOptionså‚æ•°çš„åˆ—è¡¨ã€‚</li>
<li>outputOptionsï¼šè¾“å‡ºé€‰é¡¹ï¼ŒæŒ‡å®šæ˜¾ç¤ºæŸä¸€ç§Javaè™šæ‹Ÿæœºä¿¡æ¯ã€‚</li>
<li>-tï¼šæŠŠæ—¶é—´æˆ³åˆ—æ˜¾ç¤ºä¸ºè¾“å‡ºçš„ç¬¬ä¸€åˆ—ã€‚è¿™ä¸ªæ—¶é—´æˆ³æ˜¯ä»Javaè™šæ‹Ÿæœºçš„å¼€å§‹è¿è¡Œåˆ°ç°åœ¨çš„ç§’æ•°ã€‚</li>
<li>-h nï¼šæ¯æ˜¾ç¤ºnè¡Œæ˜¾ç¤ºä¸€æ¬¡è¡¨å¤´ï¼Œå…¶ä¸­nä¸ºæ­£æ•´æ•°ã€‚é»˜è®¤å€¼ä¸º 0ï¼Œå³ä»…åœ¨ç¬¬ä¸€è¡Œæ•°æ®æ˜¾ç¤ºä¸€æ¬¡è¡¨å¤´ã€‚</li>
<li>vmidï¼šè™šæ‹Ÿæœºå”¯ä¸€IDï¼ˆLVMIDï¼ŒLocal Virtual Machine Identifierï¼‰ï¼Œå¦‚æœæŸ¥çœ‹æœ¬æœºå°±æ˜¯Javaè¿›ç¨‹çš„è¿›ç¨‹IDã€‚</li>
<li>intervalï¼šæ˜¾ç¤ºä¿¡æ¯çš„æ—¶é—´é—´éš”ï¼Œå•ä½é»˜è®¤æ¯«ç§’ã€‚ä¹Ÿå¯ä»¥æŒ‡å®šç§’ä¸ºå•ä½ï¼Œæ¯”å¦‚ï¼š1sã€‚å¦‚æœæŒ‡å®šäº†è¯¥å‚æ•°ï¼Œjstatå‘½ä»¤å°†æ¯éš”è¿™æ®µæ—¶é—´æ˜¾ç¤ºä¸€æ¬¡ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>countï¼šæ˜¾ç¤ºæ•°æ®çš„æ¬¡æ•°ï¼Œé»˜è®¤å€¼æ˜¯æ— ç©·å¤§ï¼Œè¿™å°†å¯¼è‡´jstatå‘½ä»¤ä¸€ç›´æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œç›´åˆ°ç›®æ ‡JVMç»ˆæ­¢æˆ–jstatå‘½ä»¤ç»ˆæ­¢ã€‚<br>è¾“å‡ºé€‰é¡¹<br>å¦‚æœä¸æŒ‡å®šé€šç”¨é€‰é¡¹ï¼ˆgeneralOptionsï¼‰ï¼Œåˆ™å¯ä»¥æŒ‡å®šè¾“å‡ºé€‰é¡¹ï¼ˆoutputOptionsï¼‰ã€‚è¾“å‡ºé€‰é¡¹å†³å®šjstatå‘½ä»¤æ˜¾ç¤ºçš„å†…å®¹å’Œæ ¼å¼ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</li>
<li>-classï¼šæ˜¾ç¤ºç±»åŠ è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´å’Œè£…è½½è€—æ—¶çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>-compilerï¼šæ˜¾ç¤ºå³æ—¶ç¼–è¯‘çš„æ–¹æ³•ã€è€—æ—¶ç­‰ä¿¡æ¯ã€‚</li>
<li>-gcï¼šæ˜¾ç¤ºå †å„ä¸ªåŒºåŸŸå†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>-gccapacityï¼šæ˜¾ç¤ºå †å„ä¸ªåŒºåŸŸçš„å®¹é‡åŠå…¶å¯¹åº”çš„ç©ºé—´çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>-gcutilï¼šæ˜¾ç¤ºæœ‰å…³åƒåœ¾æ”¶é›†ç»Ÿè®¡ä¿¡æ¯çš„æ‘˜è¦ã€‚</li>
<li>-gccauseï¼šæ˜¾ç¤ºå…³äºåƒåœ¾æ”¶é›†ç»Ÿè®¡ä¿¡æ¯çš„æ‘˜è¦(ä¸-gcutilç›¸åŒ)ï¼Œä»¥åŠæœ€è¿‘å’Œå½“å‰åƒåœ¾å›æ”¶çš„åŸå› ã€‚</li>
<li>-gcnewï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>-gcnewcapacityï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£çš„å¤§å°åŠå…¶å¯¹åº”çš„ç©ºé—´çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>-gcold: æ˜¾ç¤ºè€å¹´ä»£å’Œå…ƒç©ºé—´çš„åƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>-gcoldcapacityï¼šæ˜¾ç¤ºè€å¹´ä»£çš„å¤§å°ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>-gcmetacapacityï¼šæ˜¾ç¤ºå…ƒç©ºé—´çš„å¤§å°çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>-printcompilationï¼šæ˜¾ç¤ºå³æ—¶ç¼–è¯‘æ–¹æ³•çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
</ul>
<h1 id="äºŒã€çº¿ç¨‹å †æ ˆ"><a href="#äºŒã€çº¿ç¨‹å †æ ˆ" class="headerlink" title="äºŒã€çº¿ç¨‹å †æ ˆ"></a>äºŒã€çº¿ç¨‹å †æ ˆ</h1><h2 id="1-è¾“å‡º"><a href="#1-è¾“å‡º" class="headerlink" title="1.è¾“å‡º"></a>1.è¾“å‡º</h2><p>Javaè™šæ‹Ÿæœºæä¾›äº†çº¿ç¨‹è½¬å‚¨(Thread dump)çš„åé—¨ï¼Œé€šè¿‡è¿™ä¸ªåé—¨ï¼Œå¯ä»¥å°†çº¿ç¨‹å †æ ˆæ‰“å°å‡ºæ¥ã€‚è¿™ä¸ªåé—¨å°±æ˜¯é€šè¿‡å‘Javaè¿›ç¨‹å‘é€ä¸€ä¸ªQUITä¿¡å·ï¼ŒJavaè™šæ‹Ÿæœºæ”¶åˆ°è¯¥ä¿¡å·ä¹‹åï¼Œå°†ç³»ç»Ÿå½“å‰çš„JAVAçº¿ç¨‹è°ƒç”¨å †æ ˆæ‰“å°å‡ºæ¥ã€‚</p>
<p>æ‰“å°æ–¹æ³•ï¼š</p>
<ul>
<li>jstack -l pid &gt; xxx.txt éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œlinuxç³»ç»Ÿä¸­å¾€å¾€ä¼šç”¨ä¸åŒçš„ç”¨æˆ·å»æ‰§è¡Œä¸åŒçš„ç¨‹åºï¼Œæ­¤æ—¶å¯èƒ½éœ€è¦é€šè¿‡sudu -u xxx jstackçš„å½¢å¼</li>
<li>kill -3<br><em><strong>åŒæ—¶è¯·ç¡®ä¿Javaå‘½ä»¤è¡Œä¸­æ²¡æœ‰DISABLE_JAVADUMPè¿è¡Œé€‰é¡¹</strong></em></li>
</ul>
<h2 id="2-çº¿ç¨‹åˆ†æ"><a href="#2-çº¿ç¨‹åˆ†æ" class="headerlink" title="2.çº¿ç¨‹åˆ†æ"></a>2.çº¿ç¨‹åˆ†æ</h2><p>é€šè¿‡è¾“å‡ºå †æ ˆè¿›è¡Œåˆ†æ <code>jstack -l $(jps | grep xxx | awk &#39;&#123;print $1&#125;&#39;)</code> &gt; &#x2F;tmp&#x2F;xxx.jstack</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;SYS_STATUS_CHECKER&quot;</span> #<span class="number">14</span> daemon prio=<span class="number">5</span> os_prio=<span class="number">0</span> tid=<span class="number">0x00007f5e047bf000</span> nid=<span class="number">0xe15</span> waiting on condition [<span class="number">0x00007f5dd43d1000</span>]</span><br><span class="line">    java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class="line">        at java.lang.Thread.sleep(Native Method)</span><br><span class="line">ru        at com.xxx.xxx.SystemStatusChecker.run(SystemStatusChecker.java:xx)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">748</span>)        </span><br><span class="line">    Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line">                </span><br><span class="line"><span class="string">&quot;RMI Reaper&quot;</span> #<span class="number">39</span> prio=<span class="number">5</span> os_prio=<span class="number">0</span> tid=<span class="number">0x00007f5e04e4c800</span> nid=<span class="number">0xf0b</span> <span class="keyword">in</span> Object.wait() [<span class="number">0x00007f5dae2c4000</span>]</span><br><span class="line">    java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">        at java.lang.Object.wait(Native Method)</span><br><span class="line">        - waiting on &lt;<span class="number">0x00000000c0c88d20</span>&gt; (a java.lang.ref.ReferenceQueue$Lock)</span><br><span class="line">        at java.lang.ref.ReferenceQueue.<span class="built_in">remove</span>(ReferenceQueue.java:<span class="number">144</span>)</span><br><span class="line">        - locked &lt;<span class="number">0x00000000c0c88d20</span>&gt; (a java.lang.ref.ReferenceQueue$Lock)</span><br><span class="line">        at java.lang.ref.ReferenceQueue.<span class="built_in">remove</span>(ReferenceQueue.java:<span class="number">165</span>)</span><br><span class="line">        at sun.rmi.transport.ObjectTable$Reaper.run(ObjectTable.java:<span class="number">351</span>)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line">    Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line">        </span><br><span class="line"><span class="string">&quot;main&quot;</span> #<span class="number">1</span> prio=<span class="number">5</span> os_prio=<span class="number">0</span> tid=<span class="number">0x00007f5e0400a000</span> nid=<span class="number">0xdcb</span> runnable [<span class="number">0x00007f5e0b393000</span>]</span><br><span class="line">    java.lang.Thread.State: RUNNABLE</span><br><span class="line">        at java.net.PlainSocketImpl.socketAccept(Native Method)</span><br><span class="line">        at java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:<span class="number">409</span>)</span><br><span class="line">        at java.net.ServerSocket.implAccept(ServerSocket.java:<span class="number">545</span>)</span><br><span class="line">        at java.net.ServerSocket.accept(ServerSocket.java:<span class="number">513</span>)</span><br><span class="line">        at com.xxx.common.xxx.await(CommonMain.java:<span class="number">244</span>)</span><br><span class="line">        at com.xxx.common.xxx.startup(CommonMain.java:<span class="number">207</span>)</span><br><span class="line">        at com.xxx.common.xxx.main(CommonMain.java:<span class="number">147</span>)</span><br><span class="line">    Locked ownable synchronizers:</span><br><span class="line">        - None</span><br></pre></td></tr></table></figure>
<p>åœ¨RMIçº¿ç¨‹ä¸­å¯ä»¥çœ‹åˆ° â€œ - locked &lt;0x00000000c0c88d20&gt; (a java.lang.ref.ReferenceQueue$Lock)â€ è¡¨ç¤ºè¯¥çº¿ç¨‹å·²ç»ä½¿ç”¨äº†IDä¸ºâ€0x00000000c0c88d2â€çš„é”ï¼Œé”çš„IDç”±ç³»ç»Ÿè‡ªåŠ¨äº§ç”Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;main&quot;  prio=5     os_prio=0          tid=0x00007f5e0400a000 nid=0xdcb      runnable [0x00007f5e0b393000]</span><br><span class="line">|       |          |                  |                      |              |         |</span><br><span class="line">çº¿ç¨‹åç§° çº¿ç¨‹ä¼˜å…ˆçº§   æ“ä½œç³»ç»Ÿçº§åˆ«çš„ä¼˜å…ˆçº§   çº¿ç¨‹id                 å¯¹åº”çš„æœ¬åœ°çº¿ç¨‹ID  çŠ¶æ€      çº¿ç¨‹å ç”¨å†…å­˜åœ°å€</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­â€çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°çº¿ç¨‹idå·â€æ‰€æŒ‡çš„â€æœ¬åœ°çº¿ç¨‹â€æ˜¯æŒ‡è¯¥Javaçº¿ç¨‹æ‰€å¯¹åº”çš„è™šæ‹Ÿæœºä¸­çš„æœ¬åœ°çº¿ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“Javaæ˜¯è§£æå‹è¯­è¨€ï¼Œæ‰§è¡Œçš„å®ä½“æ˜¯Javaè™šæ‹Ÿæœºï¼Œå› æ­¤Javaè¯­è¨€ä¸­çš„çº¿ç¨‹æ˜¯ ä¾é™„äºJavaè™šæ‹Ÿæœºä¸­çš„æœ¬åœ°çº¿ç¨‹æ¥è¿è¡Œçš„ï¼Œå®é™…ä¸Šæ˜¯æœ¬åœ°çº¿ç¨‹åœ¨æ‰§è¡ŒJavaçº¿ç¨‹ä»£ç ã€‚</p>
<p>Javaä»£ç  ä¸­åˆ›å»ºä¸€ä¸ªthreadï¼Œè™šæ‹Ÿæœºåœ¨è¿è¡ŒæœŸå°±ä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„æœ¬åœ°çº¿ç¨‹ï¼Œè€Œè¿™ä¸ªæœ¬åœ°çº¿ç¨‹æ‰æ˜¯çœŸæ­£çš„çº¿ç¨‹å®ä½“ã€‚ä¸ºäº†æ›´åŠ æ·±å…¥å¾—ç†è§£æœ¬åœ°çº¿ç¨‹å’ŒJavaçº¿ç¨‹çš„å…³ç³»ï¼Œåœ¨Unix&#x2F;Linuxä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€š å¦‚ä¸‹æ–¹å¼æŠŠJavaè™šæ‹Ÿæœºçš„æœ¬åœ°çº¿ç¨‹æ‰“å°å‡ºæ¥ï¼š</p>
<ul>
<li>ä½¿ç”¨ps -ef | grep java è·å¾—Javaè¿›ç¨‹IDã€‚</li>
<li>ä½¿ç”¨pstack <java pid>è·å¾—Javaè™šæ‹Ÿæœºçš„æœ¬åœ°çº¿ç¨‹çš„å †æ ˆ<br>å…¶ä¸­æœ¬åœ°çº¿ç¨‹å„é¡¹å«ä¹‰å¦‚ä¸‹ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Thread 56 (Thread 0x7f5e0b394700 (LWP 3531))</span><br><span class="line">|                 |                 |</span><br><span class="line">|                 |                 +----æœ¬åœ°çº¿ç¨‹id(å¦ä¸€ç§è¡¨ç¤º,LWP-light weight process)</span><br><span class="line">|                 +-------------------æœ¬åœ°çº¿ç¨‹id</span><br><span class="line">+------------------------------çº¿ç¨‹åç§°</span><br></pre></td></tr></table></figure>
è€Œé€šè¿‡jstackè¾“å‡ºçš„mainæœ¬åœ°çº¿ç¨‹IDä¸º0xdcbï¼Œå…¶10è¿›åˆ¶æ­£å¥½ä¸º3531ã€‚</li>
</ul>
<p>â€œrunnableâ€è¡¨ç¤ºå½“å‰çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ã€‚è¿™ä¸ªrunnableçŠ¶æ€æ˜¯ä»è™šæ‹Ÿæœºçš„è§’åº¦æ¥çœ‹çš„, è¡¨ç¤ºè¿™ä¸ªçº¿ç¨‹æ­£åœ¨è¿è¡Œ</p>
<p><strong>âš ï¸ NOTE:</strong> ä½†æ˜¯å¤„äºRunnableçŠ¶æ€çš„çº¿ç¨‹ä¸ä¸€å®šçœŸçš„æ¶ˆè€—CPU. å¤„äºRunnableçš„çº¿ç¨‹åªèƒ½è¯´æ˜è¯¥çº¿ç¨‹æ²¡æœ‰é˜»å¡åœ¨javaçš„waitæˆ–è€…sleepæ–¹æ³•ä¸Šï¼ŒåŒæ—¶ä¹Ÿæ²¡ç­‰å¾…åœ¨é”ä¸Šé¢ã€‚ä½†æ˜¯å¦‚æœè¯¥çº¿ç¨‹è°ƒç”¨äº†æœ¬åœ°æ–¹æ³•ï¼Œè€Œæœ¬åœ°æ–¹æ³•å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™è™šæ‹Ÿæœºæ˜¯ä¸çŸ¥é“æœ¬åœ°ä»£ç ä¸­å‘ç”Ÿ äº†ä»€ä¹ˆï¼ˆä½†æ“ä½œç³»ç»Ÿæ˜¯çŸ¥é“çš„ï¼Œpstackå°±æ˜¯æ“ä½œæä¾›çš„ä¸€ä¸ªå‘½ä»¤ï¼Œå®ƒçŸ¥é“å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æœ¬åœ°ä»£ç ä¸Šä¸‹æ–‡ï¼‰ï¼Œæ­¤æ—¶å°½ç®¡å½“å‰çº¿ç¨‹å®é™…ä¸Šä¹Ÿæ˜¯é˜»å¡çš„çŠ¶æ€ï¼Œä½†å®é™…ä¸Šæ˜¾ç¤ºå‡ºæ¥çš„è¿˜æ˜¯runnableçŠ¶æ€ï¼Œ è¿™ç§æƒ…å†µä¸‹æ˜¯ä¸æ¶ˆè€—CPUçš„</p>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. å¤„äºwaittigå’ŒblockedçŠ¶æ€çš„çº¿ç¨‹éƒ½ä¸ä¼šæ¶ˆè€—CPU </span><br><span class="line">2. çº¿ç¨‹é¢‘ç¹åœ°æŒ‚èµ·å’Œå”¤é†’éœ€è¦æ¶ˆè€—CPU, è€Œä¸”ä»£ä»·é¢‡å¤§</span><br></pre></td></tr></table></figure>
<ul>
<li>TIMED_WAITING(on object monitor) è¡¨ç¤ºå½“å‰çº¿ç¨‹è¢«æŒ‚èµ·ä¸€æ®µæ—¶é—´,è¯´æ˜è¯¥çº¿ç¨‹æ­£åœ¨ æ‰§è¡Œobj.wait(int time)æ–¹æ³•.</li>
<li>TIMED_WAITING(sleeping) è¡¨ç¤ºå½“å‰çº¿ç¨‹è¢«æŒ‚èµ·ä¸€æ®µæ—¶é—´,å³æ­£åœ¨æ‰§è¡ŒThread.sleep(int time)æ–¹æ³•. </li>
<li>TIMED_WAITING(parking) å½“å‰çº¿ç¨‹è¢«æŒ‚èµ·ä¸€æ®µæ—¶é—´,å³æ­£åœ¨æ‰§è¡ŒThread.sleep(int time)æ–¹æ³•.</li>
<li>WAINTING(on object monitor) å½“å‰çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œå³æ­£åœ¨æ‰§è¡Œobj.wait()æ–¹æ³•(æ— å‚æ•°çš„wait()æ–¹æ³•).<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¤„äºTIMED_WAITINGã€WAINTINGçŠ¶æ€çš„çº¿ç¨‹ä¸€å®šä¸æ¶ˆè€—CPU. å¤„äºRUNNABLEçš„çº¿ç¨‹ï¼Œè¦ç»“åˆå½“å‰çº¿ç¨‹ä»£ç çš„æ€§è´¨åˆ¤æ–­ï¼Œæ˜¯å¦æ¶ˆè€—CPU.</span><br><span class="line">â€¢ å¦‚æœæ˜¯çº¯Javaè¿ç®—ä»£ç ï¼Œåˆ™æ¶ˆè€—CPU.</span><br><span class="line">â€¢ å¦‚æœæ˜¯ç½‘ç»œIO,å¾ˆå°‘æ¶ˆè€—CPU.</span><br><span class="line">â€¢ å¦‚æœæ˜¯æœ¬åœ°ä»£ç ï¼Œç»“åˆæœ¬åœ°ä»£ç çš„æ€§è´¨åˆ¤æ–­(å¯ä»¥é€šè¿‡pstack/gstackè·å–æœ¬åœ°çº¿ç¨‹å †æ ˆ)ï¼Œ å¦‚æœæ˜¯çº¯è¿ç®—ä»£ç ï¼Œåˆ™æ¶ˆè€—CPU, å¦‚æœè¢«æŒ‚èµ·ï¼Œåˆ™ä¸æ¶ˆè€—CPU,å¦‚æœæ˜¯IO,åˆ™ä¸æ€ä¹ˆæ¶ˆ è€—CPUã€‚</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="ä¸‰ã€ç›¸å…³çš„æ’æŸ¥æ–¹æ³•"><a href="#ä¸‰ã€ç›¸å…³çš„æ’æŸ¥æ–¹æ³•" class="headerlink" title="ä¸‰ã€ç›¸å…³çš„æ’æŸ¥æ–¹æ³•"></a>ä¸‰ã€ç›¸å…³çš„æ’æŸ¥æ–¹æ³•</h1><h2 id="1-CPU"><a href="#1-CPU" class="headerlink" title="1.CPU"></a>1.CPU</h2><p>ç”Ÿäº§ç¯å¢ƒä¸­å¾€å¾€ä¼šå‡ºç°CPUé£™é«˜çš„æƒ…å†µï¼Œå¯¹äºJAVAåº”ç”¨è€Œè¨€ï¼Œæ­¤ç±»é—®é¢˜ç›¸å¯¹è¾ƒå¥½ç¡®å®šé—®é¢˜æ–¹å‘ã€‚</p>
<h3 id="1-1-ä½¿ç”¨jstackç¡®å®šCPUå ç”¨é«˜çš„çº¿ç¨‹"><a href="#1-1-ä½¿ç”¨jstackç¡®å®šCPUå ç”¨é«˜çš„çº¿ç¨‹" class="headerlink" title="1.1 ä½¿ç”¨jstackç¡®å®šCPUå ç”¨é«˜çš„çº¿ç¨‹\"></a>1.1 ä½¿ç”¨jstackç¡®å®šCPUå ç”¨é«˜çš„çº¿ç¨‹\</h3><p>é€šè¿‡<code>top</code>æŒ‡ä»¤ï¼Œå¯ä»¥çœ‹åˆ°è¿›ç¨‹å ç”¨çš„ä¸€äº›åŸºç¡€èµ„æºä¿¡æ¯ï¼Œç„¶åâ€œPâ€é”®å¯ä»¥æŒ‰ç…§CPUä½¿ç”¨ç‡è¿›è¡Œæ’åºï¼Œâ€œMâ€é”®å¯ä»¥æŒ‰ç…§å†…å­˜å ç”¨æƒ…å†µè¿›è¡Œæ’åº</p>
<p>æ‰¾åˆ°CPUå ç”¨é«˜çš„è¿›ç¨‹pidï¼Œç„¶åå°†jstackä¿¡æ¯å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­å»ï¼Œé€šè¿‡<code>top -Hp pid</code>æŸ¥çœ‹å…·ä½“çš„æƒ…å†µã€‚</p>
<p>é€šè¿‡ <code>printf &#39;%x\n&#39; pid</code>å°†pidè½¬æ¢ä¸º16è¿›åˆ¶ï¼Œç„¶ååœ¨jstackæ–‡ä»¶ä¸­æ ¹æ®å¯¹åº”çš„æ•°å­—è¿›è¡ŒæŸ¥æ‰¾ï¼Œç„¶åé’ˆå¯¹æ€§çš„è¿›è¡Œåˆ†æ</p>
<h3 id="1-2-é¢‘ç¹GC"><a href="#1-2-é¢‘ç¹GC" class="headerlink" title="1.2 é¢‘ç¹GC"></a>1.2 é¢‘ç¹GC</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬å¯ä»¥å…ˆç¡®å®šä¸‹gcæ˜¯ä¸æ˜¯å¤ªé¢‘ç¹ï¼Œä½¿ç”¨<code>jstat -gc pid 1000</code>å‘½ä»¤æ¥å¯¹gcåˆ†ä»£å˜åŒ–æƒ…å†µè¿›è¡Œè§‚å¯Ÿï¼Œ1000è¡¨ç¤ºé‡‡æ ·é—´éš”(ms)ï¼Œ<code>S0C/S1Cã€S0U/S1Uã€EC/EUã€OC/OUã€MC/MU</code>åˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªSurvivoråŒºã€EdenåŒºã€è€å¹´ä»£ã€å…ƒæ•°æ®åŒºçš„å®¹é‡å’Œä½¿ç”¨é‡ã€‚<code>YGC/YGTã€FGC/FGCTã€GCT</code>åˆ™ä»£è¡¨YoungGcã€FullGcçš„è€—æ—¶å’Œæ¬¡æ•°ä»¥åŠæ€»è€—æ—¶ã€‚å¦‚æœçœ‹åˆ°gcæ¯”è¾ƒé¢‘ç¹ï¼Œå†é’ˆå¯¹gcæ–¹é¢åšè¿›ä¸€æ­¥åˆ†æã€‚<br><img src="/../images/gc.png" alt="alt text"></p>
<h3 id="1-3-é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#1-3-é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="1.3 é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>1.3 é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>é’ˆå¯¹é¢‘ç¹ä¸Šä¸‹æ–‡é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨vmstatå‘½ä»¤æ¥è¿›è¡ŒæŸ¥çœ‹<br><img src="/../images/vmstat.png" alt="alt text"><br>cs(context switch)ä¸€åˆ—åˆ™ä»£è¡¨äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›å¯¹ç‰¹å®šçš„pidè¿›è¡Œç›‘æ§é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>pidstat -w pid</code>å‘½ä»¤ï¼Œcswchå’Œnvcswchè¡¨ç¤ºè‡ªæ„¿åŠéè‡ªæ„¿åˆ‡æ¢ã€‚</p>
<h2 id="2-å†…å­˜"><a href="#2-å†…å­˜" class="headerlink" title="2.å†…å­˜"></a>2.å†…å­˜</h2><p>å¯¹äºJAVAåº”ç”¨ï¼Œæ¶‰åŠåˆ°çš„å†…å­˜é—®é¢˜ä¸»è¦åŒ…æ‹¬OOMã€GCé—®é¢˜å’Œå †å¤–å†…å­˜ã€‚</p>
<h3 id="2-1-OOM"><a href="#2-1-OOM" class="headerlink" title="2.1 OOM"></a>2.1 OOM</h3><p>JVMä¸­çš„å†…å­˜ä¸è¶³ï¼ŒOOMå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µ</p>
<ul>
<li><code>Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: unable to create new native thread</code> è¿™ä¸ªæ„æ€æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ç»™çº¿ç¨‹åˆ†é…javaæ ˆï¼ŒåŸºæœ¬ä¸Šè¿˜æ˜¯çº¿ç¨‹æ± ä»£ç å†™çš„æœ‰é—®é¢˜ï¼Œæ¯”å¦‚è¯´å¿˜è®°shutdownï¼Œæ‰€ä»¥è¯´åº”è¯¥é¦–å…ˆä»ä»£ç å±‚é¢æ¥å¯»æ‰¾é—®é¢˜ï¼Œä½¿ç”¨jstackæˆ–è€…jmapã€‚å¦‚æœä¸€åˆ‡éƒ½æ­£å¸¸ï¼ŒJVMæ–¹é¢å¯ä»¥é€šè¿‡æŒ‡å®šXssæ¥å‡å°‘å•ä¸ªthread stackçš„å¤§å°ã€‚å¦å¤–ä¹Ÿå¯ä»¥åœ¨ç³»ç»Ÿå±‚é¢ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹<code>/etc/security/limits.confnofile</code>å’Œ<code>nproc</code>æ¥å¢å¤§oså¯¹çº¿ç¨‹çš„é™åˆ¶</li>
<li><code>Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space </code> è¿™ä¸ªæ„æ€æ˜¯å †çš„å†…å­˜å ç”¨å·²ç»è¾¾åˆ°-Xmxè®¾ç½®çš„æœ€å¤§å€¼ï¼Œåº”è¯¥æ˜¯æœ€å¸¸è§çš„OOMé”™è¯¯äº†ã€‚è§£å†³æ€è·¯ä»ç„¶æ˜¯å…ˆåº”è¯¥åœ¨ä»£ç ä¸­æ‰¾ï¼Œæ€€ç–‘å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œé€šè¿‡jstackå’Œjmapå»å®šä½é—®é¢˜ã€‚å¦‚æœè¯´ä¸€åˆ‡éƒ½æ­£å¸¸ï¼Œæ‰éœ€è¦é€šè¿‡è°ƒæ•´Xmxçš„å€¼æ¥æ‰©å¤§å†…å­˜ã€‚</li>
<li><code>Caused by: java.lang.OutOfMemoryError: Meta space</code> è¿™ä¸ªæ„æ€æ˜¯å…ƒæ•°æ®åŒºçš„å†…å­˜å ç”¨å·²ç»è¾¾åˆ°<code>XX:MaxMetaspaceSize</code>è®¾ç½®çš„æœ€å¤§å€¼ï¼Œæ’æŸ¥æ€è·¯å’Œä¸Šé¢çš„ä¸€è‡´ï¼Œå‚æ•°æ–¹é¢å¯ä»¥é€šè¿‡<code>XX:MaxPermSize</code>æ¥è¿›è¡Œè°ƒæ•´</li>
<li><code>Exception in thread &quot;main&quot; java.lang.StackOverflowError</code> è¡¨ç¤ºçº¿ç¨‹æ ˆéœ€è¦çš„å†…å­˜å¤§äºXsså€¼ï¼ŒåŒæ ·ä¹Ÿæ˜¯å…ˆè¿›è¡Œæ’æŸ¥ï¼Œå‚æ•°æ–¹é¢é€šè¿‡Xssæ¥è°ƒæ•´ï¼Œä½†è°ƒæ•´çš„å¤ªå¤§å¯èƒ½åˆä¼šå¼•èµ·OOMã€‚</li>
</ul>
<h3 id="2-2-GCé—®é¢˜"><a href="#2-2-GCé—®é¢˜" class="headerlink" title="2.2 GCé—®é¢˜"></a>2.2 GCé—®é¢˜</h3><p>gcé—®é¢˜é™¤äº†å½±å“cpuä¹Ÿä¼šå½±å“å†…å­˜ï¼Œæ’æŸ¥æ€è·¯ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚ä¸€èˆ¬å…ˆä½¿ç”¨jstatæ¥æŸ¥çœ‹åˆ†ä»£å˜åŒ–æƒ…å†µï¼Œæ¯”å¦‚youngGCæˆ–è€…fullGCæ¬¡æ•°æ˜¯ä¸æ˜¯å¤ªå¤šå‘€ï¼›EUã€OUç­‰æŒ‡æ ‡å¢é•¿æ˜¯ä¸æ˜¯å¼‚å¸¸ç­‰ã€‚</p>
<p>çº¿ç¨‹çš„è¯å¤ªå¤šè€Œä¸”ä¸è¢«åŠæ—¶gcä¹Ÿä¼šå¼•å‘oomï¼Œå¤§éƒ¨åˆ†å°±æ˜¯ä¹‹å‰è¯´çš„<code>unable to create new native thread</code>ã€‚é™¤äº†jstackç»†ç»†åˆ†ædumpæ–‡ä»¶å¤–ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆä¼šçœ‹ä¸‹æ€»ä½“çº¿ç¨‹ï¼Œé€šè¿‡<code>pstreee -p pid |wc -l</code></p>
<h3 id="2-3-å †å¤–å†…å­˜"><a href="#2-3-å †å¤–å†…å­˜" class="headerlink" title="2.3 å †å¤–å†…å­˜"></a>2.3 å †å¤–å†…å­˜</h3><p>JVM çš„å †å¤–å†…å­˜ä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>JVM è‡ªèº«è¿è¡Œå ç”¨çš„ç©ºé—´ï¼›</li>
<li>çº¿ç¨‹æ ˆåˆ†é…å ç”¨çš„ç³»ç»Ÿå†…å­˜ï¼›</li>
<li>DirectByteBuffer å ç”¨çš„å†…å­˜ï¼›</li>
<li>JNI é‡Œåˆ†é…çš„å†…å­˜ï¼›</li>
<li>Java 8 å¼€å§‹çš„å…ƒæ•°æ®ç©ºé—´ï¼›</li>
<li>NIO ç¼“å­˜</li>
<li>Unsafe è°ƒç”¨åˆ†é…çš„å†…å­˜ï¼›</li>
<li>codecache</li>
</ul>
<p>å†°å±±å¯¹è±¡ï¼šå†°å±±å¯¹è±¡æ˜¯æŒ‡åœ¨ JVM å †é‡Œå ç”¨çš„å†…å­˜å¾ˆå°ï¼Œä½†å…¶å®å¼•ç”¨äº†ä¸€å—å¾ˆå¤§çš„æœ¬åœ°å†…å­˜ã€‚DirectByteBuffer å’Œ çº¿ç¨‹éƒ½å±äºè¿™ç±»å¯¹è±¡ã€‚</p>
<h4 id="2-3-1NMTåˆ†æå †å¤–å†…å­˜"><a href="#2-3-1NMTåˆ†æå †å¤–å†…å­˜" class="headerlink" title="2.3.1NMTåˆ†æå †å¤–å†…å­˜"></a>2.3.1NMTåˆ†æå †å¤–å†…å­˜</h4><p>NMTï¼ˆNative Memory Trackingï¼‰æ˜¯ HotSpot JVM å¼•å…¥çš„è·Ÿè¸ª JVM å†…éƒ¨ä½¿ç”¨çš„æœ¬åœ°å†…å­˜çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡ jcmd å·¥å…·è®¿é—® NMT æ•°æ®ã€‚NMT ç›®å‰ä¸æ”¯æŒè·Ÿè¸ªç¬¬ä¸‰æ–¹æœ¬åœ°ä»£ç çš„å†…å­˜åˆ†é…å’Œ JDK ç±»åº“ã€‚</p>
<p>NMT ä¸è·Ÿè¸ªé JVM ä»£ç çš„å†…å­˜åˆ†é…ï¼Œæœ¬åœ°ä»£ç é‡Œçš„å†…å­˜æ³„éœ²éœ€è¦ä½¿ç”¨æ“ä½œç³»ç»Ÿæ”¯æŒçš„å·¥å…·æ¥å®šä½ã€‚</p>
<h4 id="2-3-2-å¼€å¯-NMT"><a href="#2-3-2-å¼€å¯-NMT" class="headerlink" title="2.3.2 å¼€å¯ NMT"></a>2.3.2 å¼€å¯ NMT</h4><p>å¯ç”¨ NMT ä¼šå¸¦æ¥ 5-10% çš„æ€§èƒ½æŸå¤±ã€‚NMT çš„å†…å­˜ä½¿ç”¨ç‡æƒ…å†µéœ€è¦æ·»åŠ ä¸¤ä¸ªæœºå™¨å­— word åˆ° malloc å†…å­˜çš„ malloc å¤´é‡Œã€‚NMT å†…å­˜ä½¿ç”¨ç‡ä¹Ÿè¢« NMT è·Ÿè¸ªã€‚<br>å¯åŠ¨å‘½ä»¤ï¼š <code>-XX:NativeMemoryTracking=[off | summary | detail]</code>ã€‚</p>
<ul>
<li>offï¼šNMT é»˜è®¤æ˜¯å…³é—­çš„ï¼›</li>
<li>summaryï¼šåªæ”¶é›†å­ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨çš„æ€»è®¡æ•°æ®ï¼›</li>
<li>detailï¼šæ”¶é›†æ¯ä¸ªè°ƒç”¨ç‚¹çš„å†…å­˜ä½¿ç”¨æ•°æ®ã€‚</li>
</ul>
<h4 id="2-3-3-jcmd-è®¿é—®-NMT-æ•°æ®"><a href="#2-3-3-jcmd-è®¿é—®-NMT-æ•°æ®" class="headerlink" title="2.3.3 jcmd è®¿é—® NMT æ•°æ®"></a>2.3.3 jcmd è®¿é—® NMT æ•°æ®</h4><p>å‘½ä»¤ï¼š<br><code>jcmd &lt;pid&gt; VM.native_memory [summary | detail | baseline | summary.diff | detail.diff | shutdown] [scale= KB | MB | GB]</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/13/JAVA%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/" data-id="clzs6evof0000h2on29cp671b" data-title="JAVAé—®é¢˜å®šä½" class="article-share-link"><span class="fa fa-share">åˆ†äº«</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">å…«æœˆ 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/08/14/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/">çº¿ä¸Šæ•…éšœæ’æŸ¥æ–¹æ³•å’Œå·¥å…·ä»‹ç»</a>
          </li>
        
          <li>
            <a href="/2024/08/13/JAVA%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/">JAVAé—®é¢˜å®šä½</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 baixiaozhou<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>